<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Request - WAG Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .status-pending { background: linear-gradient(135deg, #FEF3C7, #FDE68A); }
        .status-approved { background: linear-gradient(135deg, #D1FAE5, #A7F3D0); }
        .status-rejected { background: linear-gradient(135deg, #FEE2E2, #FECACA); }
        .leave-type-annual { border-left: 4px solid #3B82F6; }
        .leave-type-sick { border-left: 4px solid #EF4444; }
        .leave-type-business { border-left: 4px solid #10B981; }
        .leave-type-other { border-left: 4px solid #8B5CF6; }
        .calendar-day { transition: all 0.2s ease; }
        .calendar-day:hover { background-color: #EBF8FF; }
        .calendar-day.selected { background-color: #3B82F6; color: white; }
        .calendar-day.disabled { background-color: #F3F4F6; color: #9CA3AF; cursor: not-allowed; }
        .balance-meter { background: linear-gradient(90deg, #EF4444 0%, #F59E0B 50%, #10B981 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-slate-800">WAG Portal</h1>
                    </div>
                </div>
                
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Dashboard</a>
                        <a href="defect-tracker.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Defect Tracker</a>
                        <a href="leave-request.html" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-md text-sm font-medium">Leave Request</a>
                        <a href="facility-reservation.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Facility Booking</a>
                        <a href="tech-board.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Tech Board</a>
                        <a href="suggestion-box.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Suggestion Box</a>
                        <a href="office-pulse.html" class="text-slate-600 hover:text-slate-800 px-3 py-2 rounded-md text-sm font-medium transition-colors">Office Pulse</a>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="roleToggle" class="bg-emerald-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-emerald-600 transition-colors">
                        Switch to Manager
                    </button>
                    <div class="relative">
                        <button id="notificationBtn" class="p-2 text-slate-600 hover:text-slate-800 relative">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M9 11h.01M9 8h.01"></path>
                            </svg>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                        </button>
                    </div>
                    <div class="relative">
                        <img id="userAvatar" class="h-8 w-8 rounded-full" src="./resources/user-avatars/avatar-1.jpg" alt="User Avatar">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800">Leave Request</h1>
                    <p class="text-slate-600 mt-2">Manage your leave requests and track approval status</p>
                </div>
                <button id="newLeaveBtn" class="bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Request Leave
                </button>
            </div>
        </div>
    </div>

    <!-- Leave Balance Cards -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-white rounded-lg shadow p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Annual Leave</p>
                        <p class="text-3xl font-bold text-blue-600" id="annualBalance">12</p>
                        <p class="text-xs text-gray-500">days remaining</p>
                    </div>
                    <div class="p-3 rounded-full bg-blue-100">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: 60%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">8 days used out of 20</p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Sick Leave</p>
                        <p class="text-3xl font-bold text-red-600" id="sickBalance">8</p>
                        <p class="text-xs text-gray-500">days remaining</p>
                    </div>
                    <div class="p-3 rounded-full bg-red-100">
                        <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-red-600 h-2 rounded-full" style="width: 20%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">2 days used out of 10</p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Business Leave</p>
                        <p class="text-3xl font-bold text-green-600" id="businessBalance">5</p>
                        <p class="text-xs text-gray-500">days remaining</p>
                    </div>
                    <div class="p-3 rounded-full bg-green-100">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
                        </svg>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">0 days used out of 5</p>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Balance</p>
                        <p class="text-3xl font-bold text-purple-600" id="totalBalance">25</p>
                        <p class="text-xs text-gray-500">days available</p>
                    </div>
                    <div class="p-3 rounded-full bg-purple-100">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="w-full balance-meter rounded-full h-2"></div>
                    <p class="text-xs text-gray-500 mt-1">25 days total available</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                <!-- Search -->
                <div class="flex-1 max-w-md">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <input id="searchInput" type="text" placeholder="Search leave requests..." class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- Filters -->
                <div class="flex flex-wrap gap-2">
                    <button id="filterAll" class="filter-btn px-4 py-2 rounded-md text-sm font-medium border border-gray-300 hover:bg-gray-50 transition-colors filter-active">
                        All
                    </button>
                    <button id="filterPending" class="filter-btn px-4 py-2 rounded-md text-sm font-medium border border-gray-300 hover:bg-gray-50 transition-colors">
                        Pending
                    </button>
                    <button id="filterApproved" class="filter-btn px-4 py-2 rounded-md text-sm font-medium border border-gray-300 hover:bg-gray-50 transition-colors">
                        Approved
                    </button>
                    <button id="filterRejected" class="filter-btn px-4 py-2 rounded-md text-sm font-medium border border-gray-300 hover:bg-gray-50 transition-colors">
                        Rejected
                    </button>
                </div>

                <!-- Sort -->
                <select id="sortSelect" class="px-4 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                    <option value="date">Sort by Date</option>
                    <option value="type">Sort by Type</option>
                    <option value="status">Sort by Status</option>
                    <option value="duration">Sort by Duration</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Leave Requests List -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-slate-800">Leave Requests</h3>
            </div>
            <div id="leaveRequestsList" class="divide-y divide-gray-200">
                <!-- Leave requests will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- New Leave Request Modal -->
    <div id="leaveModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-slate-800">Request Leave</h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="leaveForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type</label>
                        <select id="leaveType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">Select Leave Type</option>
                            <option value="annual">Annual Leave</option>
                            <option value="sick">Sick Leave</option>
                            <option value="business">Business Leave</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duration (Days)</label>
                        <input id="duration" type="number" min="0.5" max="30" step="0.5" placeholder="e.g., 2.5" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                        <input id="startDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                        <input id="endDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reason</label>
                    <textarea id="reason" rows="4" placeholder="Please provide a detailed reason for your leave request..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required></textarea>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-blue-800">Leave Balance Check</h3>
                            <div class="mt-2 text-sm text-blue-700">
                                <p id="balanceCheck">Your leave balance will be checked automatically when you select the leave type.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md text-sm font-medium hover:bg-blue-600 transition-colors">
                        Submit Request
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Leave Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-slate-800">Leave Request Details</h3>
                <button id="closeDetailModal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="detailContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-slate-800">Leave Calendar</h3>
                <button id="closeCalendarModal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="calendarContent">
                <!-- Calendar will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-slate-300">&copy; 2025 WAG Portal. Streamlining workplace operations with intelligent management solutions.</p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // Leave Request specific functionality
        let leaveRequests = [];
        let filteredRequests = [];
        let currentFilter = 'all';
        let currentSort = 'date';
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Sample leave request data
        const sampleRequests = [
            {
                id: 'LR001',
                type: 'annual',
                startDate: '2025-01-15',
                endDate: '2025-01-17',
                duration: 3,
                reason: 'Family vacation planned for long weekend',
                status: 'pending',
                requestedBy: 'John Smith',
                requestedDate: '2025-01-10',
                approvedBy: '',
                approvedDate: '',
                comments: []
            },
            {
                id: 'LR002',
                type: 'sick',
                startDate: '2025-01-08',
                endDate: '2025-01-09',
                duration: 2,
                reason: 'Flu symptoms and fever, need rest and recovery',
                status: 'approved',
                requestedBy: 'Sarah Johnson',
                requestedDate: '2025-01-08',
                approvedBy: 'Mike Chen',
                approvedDate: '2025-01-08',
                comments: [
                    { author: 'Mike Chen', date: '2025-01-08', text: 'Approved. Get well soon!' }
                ]
            },
            {
                id: 'LR003',
                type: 'business',
                startDate: '2025-01-20',
                endDate: '2025-01-22',
                duration: 3,
                reason: 'Client meeting in New York for project presentation',
                status: 'approved',
                requestedBy: 'David Wilson',
                requestedDate: '2025-01-05',
                approvedBy: 'Lisa Park',
                approvedDate: '2025-01-06',
                comments: [
                    { author: 'Lisa Park', date: '2025-01-06', text: 'Approved. Safe travels!' }
                ]
            },
            {
                id: 'LR004',
                type: 'other',
                startDate: '2025-01-25',
                endDate: '2025-01-25',
                duration: 1,
                reason: 'Personal appointment - doctor visit',
                status: 'rejected',
                requestedBy: 'Emma Davis',
                requestedDate: '2025-01-12',
                approvedBy: 'Mike Chen',
                approvedDate: '2025-01-12',
                comments: [
                    { author: 'Mike Chen', date: '2025-01-12', text: 'Please use sick leave for medical appointments' }
                ]
            },
            {
                id: 'LR005',
                type: 'annual',
                startDate: '2025-02-01',
                endDate: '2025-02-05',
                duration: 5,
                reason: 'Extended family visit and personal time off',
                status: 'pending',
                requestedBy: 'Alex Rodriguez',
                requestedDate: '2025-01-14',
                approvedBy: '',
                approvedDate: '',
                comments: []
            }
        ];

        // Leave balance data
        const leaveBalance = {
            annual: 12,
            sick: 8,
            business: 5,
            other: 2
        };

        document.addEventListener('DOMContentLoaded', function() {
            leaveRequests = [...sampleRequests];
            filteredRequests = [...leaveRequests];
            initializeLeaveRequest();
        });

        function initializeLeaveRequest() {
            renderLeaveRequests();
            updateBalanceDisplay();
            initializeEventListeners();
            
            // Initialize animations
            anime({
                targets: '.card-hover',
                translateY: [20, 0],
                opacity: [0, 1],
                duration: 600,
                delay: anime.stagger(100),
                easing: 'easeOutQuart'
            });
        }

        function initializeEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('filter-active'));
                    this.classList.add('filter-active');
                    
                    const filter = this.id.replace('filter', '').toLowerCase();
                    filterRequests(filter);
                });
            });

            // Sort dropdown
            document.getElementById('sortSelect').addEventListener('change', function() {
                currentSort = this.value;
                sortRequests();
            });

            // Search input
            document.getElementById('searchInput').addEventListener('input', function() {
                searchRequests(this.value);
            });

            // Modal controls
            document.getElementById('newLeaveBtn').addEventListener('click', openLeaveModal);
            document.getElementById('closeModal').addEventListener('click', closeLeaveModal);
            document.getElementById('cancelBtn').addEventListener('click', closeLeaveModal);
            document.getElementById('closeDetailModal').addEventListener('click', closeDetailModal);
            document.getElementById('closeCalendarModal').addEventListener('click', closeCalendarModal);

            // Form submission
            document.getElementById('leaveForm').addEventListener('submit', submitLeaveRequest);

            // Date inputs
            document.getElementById('startDate').addEventListener('change', updateDuration);
            document.getElementById('endDate').addEventListener('change', updateDuration);
            document.getElementById('leaveType').addEventListener('change', updateBalanceCheck);
        }

        function renderLeaveRequests() {
            const requestsList = document.getElementById('leaveRequestsList');
            
            if (filteredRequests.length === 0) {
                requestsList.innerHTML = `
                    <div class="px-6 py-12 text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">No leave requests found</h3>
                        <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter criteria.</p>
                    </div>
                `;
                return;
            }

            requestsList.innerHTML = filteredRequests.map(request => `
                <div class="px-6 py-4 hover:bg-gray-50 cursor-pointer leave-request-item leave-type-${request.type}" onclick="showLeaveDetail('${request.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(request.status)}">
                                    ${getStatusText(request.status)}
                                </span>
                                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getTypeColor(request.type)}">
                                    ${getTypeText(request.type)}
                                </span>
                                <span class="ml-2 text-sm font-medium text-slate-800">${request.id}</span>
                            </div>
                            <h4 class="text-lg font-semibold text-slate-800 mb-1">
                                ${getTypeText(request.type)} - ${request.duration} day${request.duration !== 1 ? 's' : ''}
                            </h4>
                            <p class="text-slate-600 text-sm mb-2">${request.reason}</p>
                            <div class="flex items-center text-sm text-slate-500">
                                <span>${formatDateRange(request.startDate, request.endDate)}</span>
                                <span class="mx-2">•</span>
                                <span>Requested by ${request.requestedBy} on ${formatDate(request.requestedDate)}</span>
                                ${request.approvedBy ? ` • Approved by ${request.approvedBy}` : ''}
                            </div>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            switch (status) {
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'approved': return 'bg-green-100 text-green-800';
                case 'rejected': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'Pending';
                case 'approved': return 'Approved';
                case 'rejected': return 'Rejected';
                default: return status;
            }
        }

        function getTypeColor(type) {
            switch (type) {
                case 'annual': return 'bg-blue-100 text-blue-800';
                case 'sick': return 'bg-red-100 text-red-800';
                case 'business': return 'bg-green-100 text-green-800';
                case 'other': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTypeText(type) {
            switch (type) {
                case 'annual': return 'Annual Leave';
                case 'sick': return 'Sick Leave';
                case 'business': return 'Business Leave';
                case 'other': return 'Other';
                default: return type;
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateRange(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start.getTime() === end.getTime()) {
                return formatDate(startDate);
            } else {
                return `${formatDate(startDate)} - ${formatDate(endDate)}`;
            }
        }

        function filterRequests(filter) {
            currentFilter = filter;
            
            if (filter === 'all') {
                filteredRequests = [...leaveRequests];
            } else {
                filteredRequests = leaveRequests.filter(request => request.status === filter);
            }
            
            sortRequests();
            renderLeaveRequests();
        }

        function sortRequests() {
            filteredRequests.sort((a, b) => {
                switch (currentSort) {
                    case 'type':
                        return a.type.localeCompare(b.type);
                    case 'status':
                        const statusOrder = { pending: 3, approved: 2, rejected: 1 };
                        return statusOrder[b.status] - statusOrder[a.status];
                    case 'duration':
                        return b.duration - a.duration;
                    default:
                        return new Date(b.requestedDate) - new Date(a.requestedDate);
                }
            });
        }

        function searchRequests(query) {
            if (!query.trim()) {
                filterRequests(currentFilter);
                return;
            }
            
            const searchTerm = query.toLowerCase();
            filteredRequests = leaveRequests.filter(request => 
                request.id.toLowerCase().includes(searchTerm) ||
                request.reason.toLowerCase().includes(searchTerm) ||
                request.type.toLowerCase().includes(searchTerm) ||
                request.requestedBy.toLowerCase().includes(searchTerm)
            );
            
            renderLeaveRequests();
        }

        function updateBalanceDisplay() {
            document.getElementById('annualBalance').textContent = leaveBalance.annual;
            document.getElementById('sickBalance').textContent = leaveBalance.sick;
            document.getElementById('businessBalance').textContent = leaveBalance.business;
            document.getElementById('totalBalance').textContent = 
                leaveBalance.annual + leaveBalance.sick + leaveBalance.business + leaveBalance.other;
        }

        function updateDuration() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                if (start <= end) {
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    document.getElementById('duration').value = diffDays;
                }
            }
        }

        function updateBalanceCheck() {
            const leaveType = document.getElementById('leaveType').value;
            const balanceCheck = document.getElementById('balanceCheck');
            
            if (leaveType && leaveBalance[leaveType] !== undefined) {
                const balance = leaveBalance[leaveType];
                balanceCheck.textContent = `You have ${balance} days of ${getTypeText(leaveType)} remaining.`;
                
                if (balance <= 2) {
                    balanceCheck.classList.add('text-red-600');
                    balanceCheck.classList.remove('text-blue-700');
                } else {
                    balanceCheck.classList.add('text-blue-700');
                    balanceCheck.classList.remove('text-red-600');
                }
            } else {
                balanceCheck.textContent = 'Your leave balance will be checked automatically when you select the leave type.';
                balanceCheck.classList.add('text-blue-700');
                balanceCheck.classList.remove('text-red-600');
            }
        }

        function openLeaveModal() {
            document.getElementById('leaveModal').classList.remove('hidden');
            document.getElementById('leaveModal').classList.add('flex');
            
            anime({
                targets: '#leaveModal .bg-white',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutBack'
            });
        }

        function closeLeaveModal() {
            anime({
                targets: '#leaveModal .bg-white',
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 200,
                easing: 'easeInBack',
                complete: function() {
                    document.getElementById('leaveModal').classList.add('hidden');
                    document.getElementById('leaveModal').classList.remove('flex');
                    document.getElementById('leaveForm').reset();
                }
            });
        }

        function closeDetailModal() {
            anime({
                targets: '#detailModal .bg-white',
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 200,
                easing: 'easeInBack',
                complete: function() {
                    document.getElementById('detailModal').classList.add('hidden');
                    document.getElementById('detailModal').classList.remove('flex');
                }
            });
        }

        function closeCalendarModal() {
            anime({
                targets: '#calendarModal .bg-white',
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 200,
                easing: 'easeInBack',
                complete: function() {
                    document.getElementById('calendarModal').classList.add('hidden');
                    document.getElementById('calendarModal').classList.remove('flex');
                }
            });
        }

        function submitLeaveRequest(event) {
            event.preventDefault();
            
            const leaveType = document.getElementById('leaveType').value;
            const duration = parseFloat(document.getElementById('duration').value);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const reason = document.getElementById('reason').value;
            
            // Check if user has enough balance
            if (leaveBalance[leaveType] < duration) {
                if (window.WAGPortal) {
                    window.WAGPortal.showToast('Insufficient leave balance for this request', 'error');
                }
                return;
            }
            
            const newRequest = {
                id: `LR${String(leaveRequests.length + 1).padStart(3, '0')}`,
                type: leaveType,
                startDate: startDate,
                endDate: endDate,
                duration: duration,
                reason: reason,
                status: 'pending',
                requestedBy: getCurrentUser().name,
                requestedDate: new Date().toISOString().split('T')[0],
                approvedBy: '',
                approvedDate: '',
                comments: []
            };
            
            leaveRequests.unshift(newRequest);
            filterRequests(currentFilter);
            closeLeaveModal();
            
            // Show success notification
            if (window.WAGPortal) {
                window.WAGPortal.showToast('Leave request submitted successfully!', 'success');
            }
        }

        function showLeaveDetail(requestId) {
            const request = leaveRequests.find(r => r.id === requestId);
            if (!request) return;
            
            const detailContent = document.getElementById('detailContent');
            detailContent.innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold text-slate-800 mb-3">Request Information</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Request ID:</span>
                                    <span class="text-sm text-slate-800">${request.id}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Leave Type:</span>
                                    <span class="text-sm text-slate-800">${getTypeText(request.type)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Duration:</span>
                                    <span class="text-sm text-slate-800">${request.duration} day${request.duration !== 1 ? 's' : ''}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Status:</span>
                                    <span class="text-sm text-slate-800 capitalize">${getStatusText(request.status)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Requested By:</span>
                                    <span class="text-sm text-slate-800">${request.requestedBy}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Requested Date:</span>
                                    <span class="text-sm text-slate-800">${formatDate(request.requestedDate)}</span>
                                </div>
                                ${request.approvedBy ? `
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Approved By:</span>
                                    <span class="text-sm text-slate-800">${request.approvedBy}</span>
                                </div>
                                ` : ''}
                                ${request.approvedDate ? `
                                <div class="flex justify-between">
                                    <span class="text-sm font-medium text-gray-600">Approved Date:</span>
                                    <span class="text-sm text-slate-800">${formatDate(request.approvedDate)}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-slate-800 mb-3">Leave Period</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-center">
                                    <p class="text-lg font-semibold text-slate-800">${formatDateRange(request.startDate, request.endDate)}</p>
                                    <p class="text-sm text-slate-600 mt-1">${request.duration} day${request.duration !== 1 ? 's' : ''} total</p>
                                </div>
                            </div>
                            
                            <h4 class="text-lg font-semibold text-slate-800 mb-3 mt-6">Reason</h4>
                            <p class="text-sm text-slate-600">${request.reason}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold text-slate-800 mb-3">Comments</h4>
                        <div class="space-y-3 max-h-48 overflow-y-auto">
                            ${request.comments.length > 0 ? request.comments.map(comment => `
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-1">
                                        <span class="font-medium text-slate-800">${comment.author}</span>
                                        <span class="text-xs text-slate-500">${formatDate(comment.date)}</span>
                                    </div>
                                    <p class="text-sm text-slate-600">${comment.text}</p>
                                </div>
                            `).join('') : '<p class="text-sm text-slate-500">No comments yet.</p>'}
                        </div>
                    </div>
                    
                    ${request.status === 'pending' && window.WAGPortal && window.WAGPortal.currentUserRole === 'manager' ? `
                    <div class="border-t pt-6">
                        <h4 class="text-lg font-semibold text-slate-800 mb-3">Manager Actions</h4>
                        <div class="flex space-x-3">
                            <button onclick="approveLeave('${request.id}')" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors">
                                Approve Request
                            </button>
                            <button onclick="rejectLeave('${request.id}')" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                                Reject Request
                            </button>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('detailModal').classList.remove('hidden');
            document.getElementById('detailModal').classList.add('flex');
            
            anime({
                targets: '#detailModal .bg-white',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutBack'
            });
        }

        function approveLeave(requestId) {
            const request = leaveRequests.find(r => r.id === requestId);
            if (request) {
                request.status = 'approved';
                request.approvedBy = getCurrentUser().name;
                request.approvedDate = new Date().toISOString().split('T')[0];
                request.comments.push({
                    author: getCurrentUser().name,
                    date: request.approvedDate,
                    text: 'Leave request approved'
                });
                
                // Deduct from balance
                if (leaveBalance[request.type] >= request.duration) {
                    leaveBalance[request.type] -= request.duration;
                }
                
                updateBalanceDisplay();
                filterRequests(currentFilter);
                showLeaveDetail(requestId);
                
                if (window.WAGPortal) {
                    window.WAGPortal.showToast('Leave request approved successfully!', 'success');
                }
            }
        }

        function rejectLeave(requestId) {
            const request = leaveRequests.find(r => r.id === requestId);
            if (request) {
                request.status = 'rejected';
                request.approvedBy = getCurrentUser().name;
                request.approvedDate = new Date().toISOString().split('T')[0];
                request.comments.push({
                    author: getCurrentUser().name,
                    date: request.approvedDate,
                    text: 'Leave request rejected'
                });
                
                filterRequests(currentFilter);
                showLeaveDetail(requestId);
                
                if (window.WAGPortal) {
                    window.WAGPortal.showToast('Leave request rejected', 'warning');
                }
            }
        }

        function getCurrentUser() {
            // This would normally come from authentication
            return {
                name: window.WAGPortal && window.WAGPortal.currentUserRole === 'manager' ? 'Mike Chen' : 'John Smith',
                role: window.WAGPortal ? window.WAGPortal.currentUserRole : 'user'
            };
        }

        // Calendar functionality
        function showLeaveCalendar() {
            const calendarContent = document.getElementById('calendarContent');
            calendarContent.innerHTML = generateCalendar();
            
            document.getElementById('calendarModal').classList.remove('hidden');
            document.getElementById('calendarModal').classList.add('flex');
            
            anime({
                targets: '#calendarModal .bg-white',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutBack'
            });
        }

        function generateCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            
            let calendarHTML = `
                <div class="flex justify-between items-center mb-6">
                    <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-md">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h3 class="text-xl font-semibold text-slate-800">${monthNames[currentMonth]} ${currentYear}</h3>
                    <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-md">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Sun</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Mon</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Tue</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Wed</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Thu</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Fri</div>
                    <div class="text-center text-sm font-medium text-gray-500 py-2">Sat</div>
                </div>
                
                <div class="grid grid-cols-7 gap-1">
            `;
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                calendarHTML += '<div class="calendar-day p-2 text-center text-gray-400"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateString = date.toISOString().split('T')[0];
                const isToday = dateString === new Date().toISOString().split('T')[0];
                
                // Check if this date has any leave requests
                const dayRequests = leaveRequests.filter(request => {
                    const start = new Date(request.startDate);
                    const end = new Date(request.endDate);
                    return date >= start && date <= end;
                });
                
                let dayClass = 'calendar-day p-2 text-center text-sm cursor-pointer';
                if (isToday) dayClass += ' bg-blue-100 text-blue-800 font-semibold';
                
                let dayContent = day;
                if (dayRequests.length > 0) {
                    const approvedRequests = dayRequests.filter(r => r.status === 'approved');
                    const pendingRequests = dayRequests.filter(r => r.status === 'pending');
                    
                    if (approvedRequests.length > 0) {
                        dayClass += ' bg-green-100 text-green-800';
                    } else if (pendingRequests.length > 0) {
                        dayClass += ' bg-yellow-100 text-yellow-800';
                    }
                    
                    dayContent += `<div class="text-xs mt-1">${dayRequests.length}</div>`;
                }
                
                calendarHTML += `<div class="${dayClass}" onclick="selectCalendarDate('${dateString}')">${dayContent}</div>`;
            }
            
            calendarHTML += '</div>';
            
            // Legend
            calendarHTML += `
                <div class="mt-6 flex flex-wrap gap-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-100 border border-green-300 rounded mr-2"></div>
                        <span>Approved Leave</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-100 border border-yellow-300 rounded mr-2"></div>
                        <span>Pending Leave</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-blue-100 border border-blue-300 rounded mr-2"></div>
                        <span>Today</span>
                    </div>
                </div>
            `;
            
            return calendarHTML;
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            document.getElementById('calendarContent').innerHTML = generateCalendar();
        }

        function selectCalendarDate(dateString) {
            // Handle date selection - could be used to create a new leave request
            console.log('Selected date:', dateString);
        }

        // Add calendar button to the page
        document.addEventListener('DOMContentLoaded', function() {
            const headerDiv = document.querySelector('.max-w-7xl.mx-auto.px-4.sm\\:px-6.lg\\:px-8.py-8 .flex.justify-between.items-center');
            if (headerDiv) {
                const calendarBtn = document.createElement('button');
                calendarBtn.className = 'bg-purple-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-purple-600 transition-colors flex items-center ml-4';
                calendarBtn.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    View Calendar
                `;
                calendarBtn.onclick = showLeaveCalendar;
                headerDiv.appendChild(calendarBtn);
            }
        });
    </script>
</body>
</html>